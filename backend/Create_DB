CREATE TABLE clientes (
	rut VARCHAR(20) PRIMARY KEY,
	nombre 	VARCHAR(200) NOT NULL,
	correo VARCHAR(200) NOT NULL,
	direccion VARCHAR(400) NOT NULL,
	telefono VARCHAR(200) NOT NULL,
	numero_cuenta INT NOT NULL,
	saldo_cuenta REAL DEFAULT 0,
	contrasena VARCHAR(200) NOT NULL

);

CREATE TABLE evaluacion (
	idEvaluacion SERIAL,
	clienteRut VARCHAR(20),
	sueldo INT NOT NULL,
	riesgo int NOT NULL,
	PRIMARY KEY (idEvaluacion , clienteRut),
	FOREIGN KEY (clienteRut) REFERENCES clientes(rut) ON DELETE CASCADE

);

CREATE TABLE solicitud (
	idSolicitud SERIAL,
	clienteRut VARCHAR(20),
	fechaSolicitud DATE NOT NULL,
	documentos TEXT,
	estado VARCHAR(30) NOT NULL,
	PRIMARY KEY (idSolicitud, clienteRut),
	FOREIGN KEY (clienteRut) REFERENCES clientes(rut) ON DELETE CASCADE

);

CREATE TABLE prestamo (
    idPrestamo SERIAL,
    idSolicitud INT NOT NULL,
    clienteRut VARCHAR(20) NOT NULL,
    monto INT NOT NULL,
    tasa REAL NOT NULL,
    plazo INT NOT NULL,
    estado BOOLEAN NOT NULL,
    PRIMARY KEY (idPrestamo, idSolicitud, clienteRut),
    FOREIGN KEY (clienteRut) REFERENCES clientes(rut) ON DELETE CASCADE,
    FOREIGN KEY (idSolicitud, clienteRut) REFERENCES solicitud(idSolicitud, clienteRut) ON DELETE CASCADE
);


CREATE TABLE pago (
	idPago SERIAL,
	clienteRut VARCHAR(20),
	fechaPAGO DATE NOT NULL,
	dias_atraso INT DEFAULT 0,
	monto INT,
	montoAtraso REAL,
	PRIMARY KEY (idPago, clienteRut),
	FOREIGN KEY (clienteRut) REFERENCES clientes(rut) ON DELETE CASCADE

);

CREATE TABLE historialCrediticio (
	clienteRut VARCHAR(20) PRIMARY KEY,
	prestamos_historicos INT DEFAULT 0,
	prestamos_pagados_al_dia_historicos INT DEFAULT 0,
	prestamos_atrasados_historicos INT DEFAULT 0,
	prestamos_activos INT DEFAULT 0,
	maximos_dias_atraso_historico INT DEFAULT 0,
	deuda_actual REAL default 0,
	FOREIGN KEY (clienteRut) REFERENCES clientes(rut) ON DELETE CASCADE

);
